<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    
    <meta name="screen-orientation" content="portrait">
    <meta name="x5-orientation" content="portrait">
    <meta name="t5-orientation" content="portrait">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e293b">

    <title>HAN-GL MOA</title>
    
    <link rel="stylesheet" href="css/style.css">

</head>
<body>

    <div id="introScreen" class="intro-screen">
        <div class="intro-bg-container">
            <div class="board-3d">
                <img src="images/intro_board.png" alt="Game Board" class="board-img">
                <svg class="drag-trail" width="100%" height="100%">
                    <path d="M120,110 L180,110 L120,180 L180,180" fill="none" stroke="#fff" stroke-width="8" stroke-linecap="round" stroke-dasharray="300" stroke-dashoffset="300"/>
                </svg>
            </div>
            <div class="bg-overlay"></div>
        </div>

        <div class="intro-content">
            <img src="images/logo_intro.png" alt="HAN-GL MOA" class="intro-logo">
            <button class="btn-start" onclick="startFromIntro()">GAME START</button>
        </div>
    </div>

    <div id="countdownOverlay" class="countdown-overlay">
        <div id="countdownCard" class="countdown-card">
            <span id="countdownText" class="countdown-text">3</span>
        </div>
        <div class="countdown-msg">Ready!</div>
    </div>

    <div id="toast" class="toast hidden">
        <span id="toastWord" class="toast-word"></span>
        <span id="toastDesc" class="toast-desc"></span>
    </div>

    <div class="header-area">
        <img src="images/logo_game.png" alt="MOA" class="header-logo">
        
        <div class="header-controls">
            <button class="btn-new-game" onclick="startWithCountdown()">
                <span id="uiNewGame">↻ 새 게임</span>
            </button>
            
            <button id="btnSettings" class="btn-icon-setting" onclick="openSettingsModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 5 4.6a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </div>
    </div>

    <div class="control-bar">
        <button id="btnGridSize" class="setting-btn" onclick="openOptionModal('grid')">
            <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="3" y1="15" x2="21" y2="15"></line><line x1="9" y1="3" x2="9" y2="21"></line><line x1="15" y1="3" x2="15" y2="21"></line></svg>
            <span id="txtGridSize">4x4</span>
        </button>

        <button id="btnLevel" class="setting-btn" onclick="openOptionModal('level')">
            <svg class="setting-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>
            <span id="txtLevel">랜덤</span>
        </button>

        <div class="mode-switch">
            <button class="mode-btn active" id="btnPractice" onclick="setMode('practice')">연습</button>
            <button class="mode-btn" id="btnChallenge" onclick="setMode('challenge')">챌린지</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-group">
            <span class="stat-label">SCORE</span>
            <div>
                <span class="score-val" id="score">0</span>
                <span class="score-target" id="targetScoreDisplay">/ 100</span>
            </div>
        </div>

        <div class="stat-group" id="statWordGroup" style="display:none;">
            <span class="stat-label" id="uiStatWordLabel">단어 (찾은것/전체)</span>
            <div>
                <span class="score-val" id="foundCount">0</span>
                <span class="score-target" id="totalCount">/ 0</span>
            </div>
        </div>

        <div class="stat-group" style="align-items:flex-end;">
            <span class="stat-label">TIME</span>
            <div class="timer-val" id="timer">00:00</div>
        </div>
    </div>

    <div class="found-area">
        <div class="word-list" id="wordList"></div>
    </div>

    <div class="bottom-container">
        <div class="mission-container">
            <div id="hintTooltip" class="hint-tooltip">눌러서 힌트 보기!</div>
            <div id="hintBar" class="mission-bar hidden">
                <span class="mission-icon">🎁</span>
                <span id="hintText">힌트</span> <span id="hintScore" class="mission-score">+50</span>
            </div>
            <button id="btnHint" class="hint-btn hidden" onclick="useHint()">
                💡 힌트 보기
            </button>
        </div>

        <div class="current-word" id="currentWord">시작</div>
        <div class="grid" id="grid">
            <div id="gridInner" class="grid-inner"></div>
        </div>
    </div>

    <div class="overlay" id="optionModal">
        <div class="modal">
            <div class="modal-title" id="optTitle">설정</div>
            <div class="option-list" id="optList"></div>
            <button class="btn-full btn-gray" id="uiCloseOption" onclick="closeOptionModal()">닫기</button>
        </div>
    </div>

    <div class="overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-title" id="uiSettingsTitle">설정</div>
            
            <div style="margin: 20px 0;">
                <div class="setting-item">
                    <div class="setting-label" id="uiVibration">📳 진동 효과</div>
                    <label class="switch">
                        <input type="checkbox" id="vibrateToggle" checked onchange="toggleVibration(this)">
                        <span class="slider round"></span>
                    </label>
                </div>

                <div class="setting-item">
                    <div class="setting-label" id="uiSound">🔊 효과음</div>
                    <label class="switch">
                        <input type="checkbox" id="soundToggle" checked onchange="toggleSound(this)">
                        <span class="slider round"></span>
                    </label>
                </div>
            </div>

            <hr class="divider">

            <button id="btnRemoveAdsInSetting" class="btn-premium" onclick="AdManager.purchaseRemoveAds()">
                🚫 광고 제거 (프리미엄)
            </button>

            <button class="btn-full btn-gray" id="uiCloseSettings" style="margin-top:15px;" onclick="closeSettingsModal()">닫기</button>
            
            <div class="source-info-area">
                <div class="source-title" id="uiSourceTitle">자료 출처</div>
                <p class="source-desc" id="uiSourceDesc"></p>
                <div class="source-links">
                  <a id="uiLinkUrimalsaem" href="https://opendict.korean.go.kr" target="_blank">우리말샘</a>
                  <span class="divider-vertical">|</span>
                   <a id="uiLinkBasicDict" href="https://krdict.korean.go.kr" target="_blank">한국어기초사전</a>
              </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="resultModal">
        <div class="modal">
            <span class="modal-icon" id="resIcon">🎉</span>
            <div class="modal-title" id="resTitle">성공!</div>
            <div class="modal-desc" id="resDesc">목표 점수를 달성했습니다!</div>
            <button class="btn-full bg-green" id="resBtn" onclick="startWithCountdown()">새 게임 시작</button>
        </div>
    </div>

    <div class="sheet-wrapper" id="sheetOverlay" onclick="closeSheet()">
        <div class="sheet-bg"></div>
        <div class="sheet" onclick="event.stopPropagation()">
            <h2 id="sheetWord">단어</h2>
            <div id="sheetEng" class="sheet-eng-word"></div>
            <div id="sheetEngDesc" class="sheet-eng-desc"></div>
            <div id="sheetDesc" class="sheet-desc"></div>
            <button id="btnNaver" class="btn-full bg-green" style="margin-top:10px;">
                📖 네이버 사전 검색
            </button>
            <button class="btn-full btn-gray" id="uiCloseSheet" onclick="closeSheet()">닫기</button>
        </div>
    </div>
    
    <canvas id="confetti-canvas"></canvas>

    <script type="module" src="js/game.js"></script>
    
</body>
</html>